<style>
    .componentDefinition:target {
        border: 5px solid #8f0000;
    }
</style>
<div class="container">
    <div class="jumbotron">
        <h1>{{ project.name }}</h1>
        <p>{{ project.desc }}</p>
    </div>

    <h2>Задание</h2>

    <h3>Страницы</h3>

    {% if project.tasks.pages %}
        {% for page in project.tasks.pages %}
            {% set workPage = project.work.getPage(page.sid) %}

            {% if workPage.fileExists %}
                <h4 class="bg-success">
                    <a href="{{ workPage.url }}">
                        {{ page.sid }}
                    </a>
                </h4>
            {% else %}
                <h4 class="bg-danger">
                    {{ page.sid }}
                </h4>
            {% endif %}

            <p>Файл: {{ workPage.getFile('@root') }}</p>

            {% if page.previews %}
                <a class="" role="button" data-toggle="collapse" href="#{{ page.sid }}-previews">
                    Просмотр макетов »
                </a>
                <div class="collapse" id="{{ page.sid }}-previews">
                    <div class="row">
                        {% for preview in page.getPreviews({sort: {width: 'SORT_DESC'}}) %}
                            <div class="col-sm-4">
                                <div class="thumbnail">
                                    <div style="height: 200px; overflow: hidden">
                                        {#<a href=" \yii\helpers\Url::to(['site/page-preview', 'pageSid' => $page['sid'], 'previewSid' => $preview['sid']]) ?>">#}
                                        {% set imgUrl = preview.getImageUrl() %}
                                        <a href="{{ Url.to({0: 'project/show-preview-widgets', projectSid: project.sid, previewSid: preview.sid, designSid: preview.design.sid }) }}">
                                            <img style="max-width: 100%" src="{{ imgUrl }}">
                                        </a>
                                    </div>
                                    <div class="caption">
                                        <h3>{{ preview.sid }}</h3>
                                        <p>Файл: {{ preview['file'] }}</p>
                                        <p>Ширина: {{ preview['width'] }} px</p>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}

        {% endfor %}
    {% else %}
        <p>Заданий по страницам нет.</p>
    {% endif %}


    <h3>Виджеты</h3>

    {#{% set previews = project.tasks.previewsWithWidgets %}#}
    {#{% if previews %}#}
        {#<h4>Все виджеты по страницам</h4>#}
        {#{% for preview in previews %}#}
            {#<a href="">#}
                {#{{ preview.qid }}#}
            {#</a>#}
        {#{% endfor %}#}
    {#{% endif %}#}

    {% if project.tasks.widgets %}
        <div class="row">

            {% for widgetTask in project.tasks.widgets %}
                {% set workWidget = project.work.getWidget(widgetTask.sid) %}
                <div class="col-xs-6 componentDefinition" id="component-{{ widgetTask.sid }}">
                    {% if workWidget.fileExists %}
                        <h4 class="bg-success">
                            <a href="{{ Url.to({0: 'project/show-widget-live', projectSid: project.sid, widgetSid: widgetTask.sid}) }}">
                                {{ widgetTask.sid }}
                            </a>
                        </h4>
                    {% else %}
                        <h4 class="bg-danger">
                            {{ widgetTask.sid }}
                        </h4>
                    {% endif %}

                    <p>Файл: {{ workWidget.getFile('@root') }}</p>
                    <p>Требования:
                        {% if widgetTask.requirementNames %}
                            {{ widgetTask.requirementNames|join(', ') }}

                            <a href="{{ Url.to({0: 'project/show-widget-requirements', projectSid: project.sid, widgetSid: widgetTask.sid }) }}">
                                подробнее »
                            </a>
                        {% else %}
                            нет
                        {% endif %}
                    </p>

                    {% if widgetTask.comment %}
                        <p>Комментарий: {{ widgetTask.comment }} </p>
                    {% endif %}

                    {% if widgetTask.appearances %}
                        Примеры на страницах:
                        <ul>
                            {% for appearance in widgetTask.appearances %}
                                {% set preview = appearance.preview %}
                                {% set previewUrl = widgetTask.getPreviewUrl(preview) %}
                                <li>
                                    <a href="{{ previewUrl }}">
                                        {{ preview.design.sid }}.{{ preview.sid }}
                                    </a>
                                    {{ appearance.comment ? ' - ' ~ appearance.comment : '' }}
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            {% endfor %}
        </div>

    {% else %}
        <p>Заданий по виджетам нет.</p>
    {% endif %}

    <h3>Нарезка</h3>

    <a href="{{ Url.to({0: 'project/cut-preview-board', projectSid: project.sid}) }}">Нарезка (alpha version)</a>

</div>


<div class="container">
    <footer style="padding-bottom: 40px; border-top: 1px solid #EEE; margin-top: 2em; padding-top: 1em;">
        <p class="pull-right"><a href="#">Наверх</a></p>
        <p>&copy; 2018 cronfy &middot; <a href="https://github.com/cronfy/html-template">Github</a></p>
    </footer>
</div>
