<?php
/**
 * Created by PhpStorm.
 * User: cronfy
 * Date: 15.03.18
 * Time: 12:37
 */

namespace main\assets;

use Yii;
use yii\helpers\Url;
use yii\web\AssetBundle;

class ProjectPageAsset extends AssetBundle
{
    public function init()
    {
        parent::init(); // TODO: Change the autogenerated stub

        $project = Yii::$app->view->params['html-template.project.current'];

        $config = $project->getConfig()->raw;

        foreach (@$config['assets'] ?: [] as $assetName => $contents) {
            foreach (@$contents['js'] as $js) {
                $this->js[] = $js;
            }
            foreach (@$contents['css'] ?: [] as $css) {
                $this->css[] = $css;
            }
        }

        $this->css[] = Url::to(['page/show-project-asset', 'projectName' => $project->name, 'asset' => $project->name . '.css']);
        $this->css[] = Url::to(['page/show-all-widgets-css', 'projectName' => $project->name]);

        $pageName = Yii::$app->view->params['current.page.name'];
        $pageSid = dirname($pageName);
        $this->css[] = Url::to(['page/show-page-asset', 'projectName' => $project->name, 'pageSid' => $pageSid, 'asset' => "$pageSid.css"]);
    }
}